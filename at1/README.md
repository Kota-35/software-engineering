# ソフトウェア工学（演習） 応用課題１

## TODO 管理アプリケーション

---

## 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [仕様の実装状況](#仕様の実装状況)
3. [例外処理の実装](#例外処理の実装)
4. [ユーザビリティへの配慮](#ユーザビリティへの配慮)
5. [ソースコードの可読性](#ソースコードの可読性)
6. [独自拡張機能](#独自拡張機能)

---

## プロジェクト概要

本アプリケーションは、コマンドラインインターフェース（CUI）で動作するTODO管理システムである。ユーザーは7種類の基本コマンド（`post`, `done`, `show`, `delete`, `save`, `load`, `exit`）を通じて、タスクの登録・完了・表示・削除・永続化を行うことができる。

---

## 仕様の実装状況

### 基本コマンドの実装

本アプリケーションは、要求仕様で定められた7つの基本コマンドをすべて実装している。

#### 1. post コマンド
- **形式**: `post <TODO>`
- **機能**: 新規TODOを登録する
- **実装**: `CommandHandler.handlePost()` メソッドにて、TODO内容をリポジトリに追加し、一意のIDを自動採番する

#### 2. done コマンド
- **形式**: `done <id>`
- **機能**: 指定されたIDのTODOを完了状態にする
- **実装**: `CommandHandler.handleDone()` メソッドにて、IDの妥当性を検証した上でタスクを完了状態に更新する

#### 3. show コマンド
- **形式**: `show`
- **機能**: 全てのTODOを表示する（完了済みタスクには「DONE!」が付加される）
- **実装**: `CommandHandler.handleShow()` メソッドにて、ID、内容、完了状態を含む形式で出力する

#### 4. delete コマンド
- **形式**: `delete <id>`
- **機能**: 指定されたIDのTODOを削除する
- **実装**: `CommandHandler.handleDelete()` メソッドにて、リポジトリからタスクを削除する

#### 5. save コマンド
- **形式**: `save`
- **機能**: 現在のTODOリストを `todo.txt` に保存する
- **実装**: `TaskService.save()` メソッドにて、CSVライク形式でファイルに書き出す

#### 6. load コマンド
- **形式**: `load`
- **機能**: `todo.txt` からTODOリストを読み込み、現在のリストを置き換える
- **実装**: `TaskService.load()` メソッドにて、ファイルから読み込み、リポジトリを更新する

#### 7. exit コマンド
- **形式**: `exit`
- **機能**: アプリケーションを終了する
- **実装**: `CommandHandler.run()` メソッドにて、ループを抜けてプログラムを終了する

---

## 例外処理の実装

本アプリケーションは、ユーザーの誤操作に対して適切な例外処理を実装しており、プログラムが異常終了することなく、明確なエラーメッセージを提供する。

### 主な例外処理

#### 1. 不正なID入力への対応
- **状況**: `done` や `delete` コマンドで数値以外のIDが入力された場合
- **処理**: `NumberFormatException` をキャッチし、「Invalid ID. ID must be a number.」というメッセージを表示
- **実装箇所**: `CommandHandler.handleDone()`, `CommandHandler.handleDelete()`

#### 2. 存在しないタスクへの操作
- **状況**: 指定されたIDのタスクが存在しない場合
- **処理**: `IllegalArgumentException` をスローし、「Task #<id> not found.」というメッセージを表示
- **実装箇所**: `InMemoryTaskRepository.findById()`

#### 3. ファイル操作のエラー処理
- **状況**: `save` や `load` コマンドでファイルの読み書きに失敗した場合
- **処理**: `IOException` を適切に処理し、エラーメッセージを表示
- **実装箇所**: `FileTaskStorage.saveTasks()`, `FileTaskStorage.loadTasks()`

#### 4. 不正なファイル形式への対応
- **状況**: `todo.txt` のデータが破損している場合
- **処理**: パース時の例外をキャッチし、該当行をスキップして処理を継続
- **実装箇所**: `FileTaskStorage.deserializeTask()`

#### 5. 不正なコマンド入力への対応
- **状況**: 存在しないコマンドや引数不足のコマンドが入力された場合
- **処理**: 「Command not found.」というメッセージを表示し、処理を継続
- **実装箇所**: `CommandHandler.run()`

### エラーメッセージの視認性
全てのエラーメッセージは、ANSIカラーコード（赤色）を使用して強調表示されるため、ユーザーは問題を即座に認識できる。

---

## ユーザビリティへの配慮

本アプリケーションは、CUIでありながら直感的で使いやすいインターフェースを提供するため、以下の工夫を施している。

### 1. カラフルな視覚表現
- **実装**: `ConsoleColors` クラスによるANSIエスケープコードの活用
- **効果**:
  - 成功メッセージ: 緑色で表示し、チェックマーク（✓）を付加
  - エラーメッセージ: 赤色で表示
  - 警告メッセージ: 黄色で表示
  - プロンプト: 青色・太字で表示
  - タスクID: 青色で表示

### 2. プロンプト表示
- **実装**: コマンド入力時に「TODO>」というプロンプトを表示
- **効果**: ユーザーが入力待ち状態であることを明確に示す

### 3. チェックボックス表示
- **実装**: タスク一覧表示時に、未完了タスクには「[ ]」、完了タスクには「[✓]」を表示
- **効果**: タスクの完了状態を視覚的に識別しやすい

### 4. 統計情報の表示
- **実装**: `show` コマンドでタスクの総数、完了数、未完了数を表示
- **効果**: 全体の進捗状況を一目で把握できる

### 5. 削除確認プロンプト
- **実装**: `delete` コマンド実行時に、タスク内容を表示して確認を求める
- **効果**: 誤削除を防止する

### 6. 操作フィードバック
- **実装**: 各操作の成功時に、チェックマーク付きの確認メッセージを表示
- **効果**: 操作が正常に完了したことをユーザーに明示する

---

## ソースコードの可読性

本アプリケーションは、保守性と拡張性を重視した設計となっており、以下の観点で高い可読性を実現している。

### 1. レイヤードアーキテクチャの採用

本プロジェクトは、機能のまとまりごとにディレクトリを分割し、各層の責務を明確に分離している。

```
src/main/java/at1/
├── domain/              # ドメイン層（ビジネスロジック）
│   ├── Task.java        # タスクエンティティ
│   └── TaskRepository.java  # リポジトリインターフェース
├── infrastructure/      # インフラ層（データ永続化）
│   ├── InMemoryTaskRepository.java  # インメモリ実装
│   └── FileTaskStorage.java         # ファイル永続化
├── service/            # サービス層（アプリケーションロジック）
│   └── TaskService.java
├── ui/                 # UI層（ユーザーインターフェース）
│   └── CommandHandler.java
└── util/               # ユーティリティ層
    └── ConsoleColors.java
```

#### 各層の役割

**ドメイン層 (domain/)**
- ビジネスロジックの中核を担う
- `Task`: タスクの属性（ID、名前、完了状態、作成日時）を保持
- `TaskRepository`: タスク操作のインターフェースを定義し、実装の詳細を隠蔽

**インフラ層 (infrastructure/)**
- データの永続化を担当
- `InMemoryTaskRepository`: タスクをメモリ上で管理する実装
- `FileTaskStorage`: タスクをファイルに保存・読み込みする実装

**サービス層 (service/)**
- 複数の層を跨ぐ処理を調整
- `TaskService`: リポジトリとストレージを連携させ、保存・読み込み処理を実現

**UI層 (ui/)**
- ユーザーとのインタラクションを管理
- `CommandHandler`: コマンド入力を解析し、適切なメソッドを呼び出す

**ユーティリティ層 (util/)**
- 横断的な機能を提供
- `ConsoleColors`: ANSI カラーコードを用いた表示装飾

### 2. インターフェースによる依存性の逆転

`TaskRepository` インターフェースを導入することで、依存性の逆転原則（DIP）を実現している。これにより、上位層（service, ui）は具体的な実装（InMemoryTaskRepository）に依存せず、インターフェースに依存する設計となっている。

**メリット**:
- テストが容易（モック実装に置き換え可能）
- 実装の切り替えが容易（例: InMemory → Database）

### 3. 適切な命名規則

- **クラス名**: 役割を明確に表す名詞（例: `TaskService`, `CommandHandler`）
- **メソッド名**: 動作を明確に表す動詞句（例: `handlePost()`, `markAsDone()`）
- **変数名**: 内容を示す具体的な名前（例: `nextId`, `createdAt`）

### 4. コメントの活用

各クラスおよび重要なメソッドには、目的や役割を説明するコメントが付与されている。また、複雑なロジック部分には処理内容を補足するコメントが記載されている。

**例**:
```java
// 保存用メソッド
public String toSaveString() { ... }

// [UX向上] プロンプト表示を追加
System.out.print(ConsoleColors.prompt("TODO> "));
```

### 5. 単一責任の原則（SRP）

各クラスは明確に定義された単一の責任を持つ。

- `Task`: タスクの状態を保持
- `TaskRepository`: タスクの操作を定義
- `FileTaskStorage`: ファイル入出力を担当
- `CommandHandler`: コマンドの解析と処理
- `ConsoleColors`: 表示装飾を提供

---

## 独自拡張機能

本アプリケーションは、要求仕様に加えて以下の独自機能を実装しており、より実用的で使いやすいシステムとなっている。

### 1. help コマンド

**機能**: 利用可能なコマンドの一覧とその使用方法を表示する

**実装**: `CommandHandler.handleHelp()` メソッド

**魅力**:
- 初めて使用するユーザーでもコマンドを確認できる
- 各コマンドの形式が明示されるため、入力ミスが減少する
- マニュアルを別途参照する必要がなくなる

**使用例**:
```
TODO> help
Available commands:
  post <text>      Add a new task
  done <id>        Mark a task as done
  show             Show all tasks
  show --done      Show only completed tasks
  show --todo      Show only incomplete tasks
  delete <id>      Delete a task
  save             Save tasks to file
  load             Load tasks from file
  help             Show this help message
  exit             Quit application
```

### 2. show コマンドのフィルタリングオプション

**機能**: タスクの表示を完了状態でフィルタリングする

- `show --done`: 完了済みタスクのみを表示
- `show --todo`: 未完了タスクのみを表示

**実装**: `CommandHandler.handleShow()` メソッドにて、Java Stream API を使用してフィルタリング

**魅力**:
- 大量のタスクがある場合でも、必要な情報だけを表示できる
- 完了済みタスクを確認したい場合や、残タスクだけを確認したい場合に便利
- ユーザーが情報を探す手間を削減する

### 3. タスク統計の自動表示

**機能**: `show` コマンド実行時に、タスクの総数、完了数、未完了数を自動的に表示する

**実装**: `TaskRepository` に `calculateDoneCount()` と `calculateTodoCount()` メソッドを追加

**魅力**:
- プロジェクトの進捗状況を一目で把握できる
- モチベーション向上に寄与（完了数の増加が視覚化される）
- 別途計算する必要がなく、常に最新の統計を確認できる

### 4. 削除前の確認プロンプト

**機能**: `delete` コマンド実行時に、削除対象のタスク内容を表示し、確認を求める

**実装**: `CommandHandler.handleDelete()` メソッドにて、ユーザー入力（y/N）を待つ

**魅力**:
- 誤削除による重要なタスクの喪失を防ぐ
- タスク内容を再確認できるため、安心して削除操作を行える
- 一般的なCLIツールと同様のUXを提供

### 5. タスク作成日時の記録

**機能**: タスク作成時に自動的にタイムスタンプを記録し、ファイルに保存する

**実装**: `Task` クラスに `createdAt` フィールドを追加し、`FileTaskStorage` でシリアライズ

**魅力**:
- 将来的にタスクのソート機能（作成日時順など）を実装可能
- タスクの履歴管理が可能になる
- データの追跡性が向上する

### 6. 操作成功時のフィードバック

**機能**: 各操作（post, done, delete, save, load）の成功時に、明確なメッセージを表示する

**実装**: 各ハンドラーメソッドにて、成功時にチェックマーク（✓）付きのメッセージを出力

**魅力**:
- ユーザーが操作の成否を即座に確認できる
- 特にファイル操作（save, load）では、処理が完了したことを明示的に通知
- 安心感のあるUXを提供

### 7. カラフルなコンソール出力

**機能**: ANSI エスケープコードを使用して、テキストに色や装飾を付ける

**実装**: `ConsoleColors` ユーティリティクラス

**魅力**:
- 視覚的に情報を区別しやすい
- エラーや成功メッセージが目立つため、見落としを防ぐ
- モダンなCLIツールに匹敵する洗練された見た目
- ユーザー体験の向上

---
